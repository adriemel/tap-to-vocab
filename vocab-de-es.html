<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tap-to-Vocab DE→ES (Spanish voice)</title>
<style>
  :root{
    --accent:#2563eb;        /* blue 600 */
    --accent-ink:#fff;
    --bg:#f8fafc;            /* slate-50 */
    --card:#ffffff;
    --ink:#0f172a;           /* slate-900 */
    --muted:#64748b;         /* slate-500 */
    --border:rgba(148,163,184,.35);
    --shadow:rgba(2,6,23,.12);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0b1220;
      --card:#111827;
      --ink:#e5e7eb;
      --muted:#9aa4b2;
      --accent:#3b82f6;
      --accent-ink:#081018;
      --border:rgba(148,163,184,.28);
      --shadow:rgba(0,0,0,.35);
    }
  }

  html,body{height:100%}
  body {
    margin:0;
    background: radial-gradient(1200px 600px at 20% -10%, rgba(37,99,235,.12), transparent 60%),
                radial-gradient(800px 500px at 120% 10%, rgba(59,130,246,.10), transparent 55%),
                var(--bg);
    color: var(--ink);
    font: 18px/1.55 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  }
  .wrap{max-width:760px;margin:2rem auto;padding:0 1rem;}
  h1 { font-size: clamp(1.4rem, 2vw + 1rem, 1.9rem); margin: 0 0 .9rem; }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.25rem;
    box-shadow: 0 10px 30px var(--shadow);
  }

  .big {
    font-size: clamp(2.1rem, 4.2vw + 1rem, 3.1rem);
    letter-spacing: .4px;
    margin: .85rem 0;
  }

  .hint { color: var(--muted); font-size: 1.15rem; }

  input, button {
    font-size: 1.1rem;
    padding: .7rem 1rem;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--ink);
  }
  button {
    background: var(--accent);
    color: var(--accent-ink);
    border: none;
    box-shadow: 0 6px 16px rgba(37,99,235,.25);
    transition: transform .04s ease, filter .12s ease;
    cursor: pointer;
  }
  button:hover { filter: brightness(1.03); }
  button:active { transform: translateY(1px); }
  .ghost { background: transparent; color: var(--ink); border: 1px solid var(--border); box-shadow:none; }

  #wordSpeaker { cursor:pointer; display:none; font-size:.9em; user-select:none; margin-left:.35rem; }
  #feedback { margin:.4rem 0; }
  .ok { color:#16a34a; }
  .err { color:#b91c1c; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Deutsch → Español</h1>
    <div id="prompt" class="big">
      <span id="promptText"></span>
      <span id="wordSpeaker"> 🔊</span>
    </div>
    <div id="translation" class="hint"></div>
    <p class="row">
      <button id="speak">🔊 Anhören (Spanisch)</button>
      <button id="reveal" class="ghost">👀 Anzeigen / Verbergen</button>
    </p>
    <p><strong>Schreibweise üben (Spanisch):</strong></p>
    <form id="spell-form">
      <input id="spell" autocomplete="off" placeholder="Spanisches Wort schreiben…" />
      <p id="feedback"></p>
      <button type="submit">Prüfen</button>
      <button type="button" id="showLetter" class="ghost">Tipp: nächsten Buchstaben</button>
    </form>
    <p id="sentence"></p>
  </div>
</div>

<script>
(function(){
  const qs   = new URLSearchParams(location.search);
  const w    = (qs.get("w")    || "").trim();        // Spanish target
  const de   = (qs.get("de")   || "").trim();        // German prompt
  const sent = (qs.get("sent") || "").trim();
  const lang = (qs.get("lang") || "es-ES").trim();   // es-ES / es-MX / es-AR
  const voiceName = (qs.get("voice") || "").trim();  // exact voice name e.g. "Mónica", "Paulina"

  const $ = id => document.getElementById(id);
  const promptTextEl = $("promptText");
  const wordSpeaker  = $("wordSpeaker");
  const translationEl= $("translation");
  const sentenceEl   = $("sentence");
  const speakBtn     = $("speak");
  const revealBtn    = $("reveal");
  const form         = $("spell-form");
  const input        = $("spell");
  const feedback     = $("feedback");
  const showLetter   = $("showLetter");

  let hidden = true;

  function render(){
    const hasAny = w || de || sent;
    promptTextEl.textContent = de || (hasAny ? "(Deutsch fehlt)" : "Hinweis (Deutsch) fehlt");
    translationEl.textContent = hidden ? "…" : (w || (hasAny ? "(Spanisch fehlt)" : "Spanisches Wort fehlt"));
    wordSpeaker.style.display = w ? "inline" : "none"; // 🔊 shows only if Spanish word exists
    sentenceEl.textContent = sent ? ("🧩 " + sent) : "";
  }
  render();

  function getVoiceByName(name){
    const voices = speechSynthesis.getVoices() || [];
    return voices.find(v => v.name && v.name.toLowerCase() === name.toLowerCase());
  }
  function speakSpanish(text){
    if (!("speechSynthesis" in window) || !text) return;
    const u = new SpeechSynthesisUtterance(text);
    if (voiceName){
      const v = getVoiceByName(voiceName);
      if (v){ u.voice = v; u.lang = v.lang; } else { u.lang = lang; }
    } else {
      u.lang = lang;
    }
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }

  speakBtn.addEventListener("click", ()=> speakSpanish(w));
  wordSpeaker.addEventListener("click", ()=> speakSpanish(w));
  revealBtn.addEventListener("click", ()=>{ hidden = !hidden; render(); });

  function normalize(s){ return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""); }
  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    const ok = normalize(input.value) === normalize(w);
    feedback.textContent = ok ? "✅ Richtig!" : "❌ Noch nicht. Nochmal versuchen.";
    if (ok){ speakSpanish(w); try{ localStorage.setItem("lastOk_"+w, Date.now()); }catch(e){} }
  });

  showLetter.addEventListener("click", ()=>{
    const typed = input.value;
    let i=0; while (i < typed.length && normalize(typed[i]) === normalize((w||"")[i])) i++;
    input.value = typed.slice(0,i) + ((w||"")[i]||"") + typed.slice(i);
    input.focus();
  });

  if (typeof speechSynthesis !== "undefined") {
    speechSynthesis.onvoiceschanged = function(){ /* no-op */ };
  }
})();
</script>
</body>
</html>
